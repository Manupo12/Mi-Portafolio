---

// - Layout específico para proyectos de tipo "web". Reutiliza la cabecera
//   y el pie comunes, muestra metadatos, descripción, tecnologías, galería
//   y enlaces (live / github).

// Imports de componentes y utilidades usados por este layout.
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import TechIcon from '../components/TechIcon.astro';
import AnimateOnScroll from '../components/AnimateOnScroll.jsx';
import { ProjectGallery } from '../components/ProjectGallery.tsx';
import { Github, ExternalLink, Calendar, Code, CheckCircle } from 'lucide-react';
import type { Project } from '../data/types.ts';
import '../styles/global.css';

// Props: frontmatter contiene los datos del proyecto. Puede ser undefined
// si se intenta cargar una página no existente, por eso validamos abajo.
interface Props {
    frontmatter: Project | undefined;
}
const { frontmatter } = Astro.props;

// Si no hay frontmatter válido redirigimos a la raíz para evitar renderizar
// una página de proyecto sin datos.
if (!frontmatter) {
    return Astro.redirect('/');
}

// Desestructuramos las propiedades que utilizaremos en el layout. `iconSrc`
// se incluye por consistencia aunque para webs habitualmente puede ser null.
const { 
    titulo, subtitulo, startDate, projectType, status, 
    githubUrl, liveUrl, media, technologies, iconSrc // iconSrc se incluye por consistencia, aunque será null
} = frontmatter;
---
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>{titulo} | Mi Portafolio</title>
    <meta name="description" content={subtitulo} />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-950 text-gray-200 font-sans">
    <div class="absolute inset-0 -z-10 h-full w-full bg-gray-950 bg-[radial-gradient(#1e293b_1px,transparent_1px)] [background-size:32px_32px]"></div>
    
    <Header />

    <main class="max-w-5xl mx-auto px-6 py-20 pt-28">
        <article class="flex flex-col space-y-16">

            <header>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8 items-center">
                    {iconSrc && (
                        <div class="md:col-span-1 flex justify-center md:justify-start">
                            <img src={iconSrc} alt={`Icono de ${titulo}`} class="w-32 h-32 md:w-40 md:h-40 rounded-3xl shadow-lg border-2 border-gray-800" />
                        </div>
                    )}
                    <div class={iconSrc ? 'md:col-span-3' : 'md:col-span-4'}>
                        <h1 class="text-4xl md:text-5xl font-black tracking-tighter text-white text-center md:text-left">{titulo}</h1>
                        <p class="text-lg text-emerald-400 text-center md:text-left mt-2">{subtitulo}</p>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center md:justify-start gap-x-6 gap-y-4 mt-8 border-b border-gray-800 pb-8">
                    {startDate && <div class="flex items-center gap-2 text-gray-400"><Calendar size={18}/><span>{startDate}</span></div>}
                    {projectType && <div class="flex items-center gap-2 text-gray-400"><Code size={18}/><span>{projectType}</span></div>}
                    {status && <div class="flex items-center gap-2 text-gray-400"><CheckCircle size={18}/><span>{status}</span></div>}
                </div>
            </header>

            <div class="prose prose-invert prose-lg max-w-3xl mx-auto prose-p:text-gray-300">
                <slot />
            </div>
            
            {technologies && technologies.length > 0 && (
                <div class="max-w-3xl mx-auto">
                    <h3 class="text-2xl font-bold text-white text-center mb-8">Tecnologías Utilizadas</h3>
                    <div class="flex flex-wrap justify-center gap-4">
                        {technologies.map((tech) => <TechIcon name={tech} />)}
                    </div>
                </div>
            )}

            {media && media.length > 0 && (
                <div>
                    <h3 class="text-2xl font-bold text-white text-center mb-8">Galería</h3>
                    <ProjectGallery media={media} projectType={projectType} client:visible />
                </div>
            )}

            <footer class="border-t border-gray-800 pt-12 space-y-10">
                <div class="flex flex-wrap justify-center gap-4">
                    {liveUrl && <a href={liveUrl} target="_blank" class="flex items-center gap-2 text-white bg-sky-600 hover:bg-sky-700 font-semibold rounded-lg px-5 py-3 transition-colors"><ExternalLink size={20} /> Visitar Sitio</a>}
                    {githubUrl && <a href={githubUrl} target="_blank" class="flex items-center gap-2 text-gray-300 bg-gray-800 hover:bg-gray-700 font-semibold rounded-lg px-5 py-3 transition-colors"><Github size={20} /> Ver Código</a>}
                </div>
                
                <div class="text-center">
                    <a href="/#proyectos" class="inline-block text-gray-300 hover:text-white font-semibold rounded-lg px-6 py-3 transition-colors">&larr; Volver a Proyectos</a>
                </div>
            </footer>

        </article>
    </main>

    <Footer />
</body>
</html>